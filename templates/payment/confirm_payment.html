{% load static %}

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">

    <title>Maricon 2024</title>
    <meta content="" name="description">
    <meta content="" name="keywords">

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;500;600;700&family=Poppins:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">

    <!-- Vendor CSS Files -->
    <link href={% static "assets/vendor/bootstrap/css/bootstrap.min.css" %} rel="stylesheet">
    <link href={% static "assets/vendor/bootstrap-icons/bootstrap-icons.css" %} rel="stylesheet">
    <link href={% static "assets/vendor/fontawesome-free/css/all.min.css" %} rel="stylesheet">
    <link href={% static "assets/vendor/glightbox/css/glightbox.min.css" %} rel="stylesheet">
    <link href={% static "assets/vendor/swiper/swiper-bundle.min.css" %} rel="stylesheet">
    <link href={% static "assets/vendor/aos/aos.css" %} rel="stylesheet">
    <link href={% static 'assets/css/main.css' %} rel="stylesheet">

    {% if err %}
    <script>
        window.onload = function () {
            alert("{{ err }}");
        }
    </script>
    {% endif %}

    <!-- Razorpay Checkout JS -->
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
</head>

<body>

    {% include "new_maricon/header.html" %}
    <main id="main">

        <!-- Breadcrumbs -->
        <div class="breadcrumbs">
            <div class="page-header d-flex align-items-center"
                style="background-image: url({% static 'img/maricon_header.png' %})">
                <div class="container position-relative">
                    <div class="row d-flex justify-content-center">
                        <div class="col-lg-6 text-center">
                            <h2>Confirm Payment</h2>
                        </div>
                    </div>
                </div>
            </div>
            <nav>
                <div class="container">
                    <ol>
                        <li><a href="/maricon/">Home</a></li>
                        <li>Confirm Payment</li>
                    </ol>
                </div>
            </nav>
        </div>

        <section id="hero " class="hero d-flex align-items-center" style="background-color: #f3f6fc">
            <div class="container">
                <div class="row gy-4 d-flex justify-content-center">
                    <div class="d-flex flex-column justify-content-center col-lg-8">
                        {% if err %}
                        <h5 class="text-danger">{{ err }}</h5>
                        {% endif %}
                        <h2 class="text-dark">Payment Details</h2>
                        <div class="text-dark">
                            Name : {{ payment.user.full_name }}
                        </div>
                        <div class="text-dark">
                            Category : {{ payment.category }}
                        </div>
                        <div class="text-dark">
                            Total Amount : {{ payment.amount }} {{ payment.currency }}
                        </div>
                        <div class="text-center">
                            <button id="rzp-button1" class="btn btn-primary">Proceed to Pay</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

    </main>
    {% include "new_maricon/footer.html" %}

    <a href="#" class="scroll-top d-flex align-items-center justify-content-center"><i
            class="bi bi-arrow-up-short"></i></a>

    <div id="preloader"></div>

    <!-- Vendor JS Files -->
    <script src={% static "assets/vendor/bootstrap/js/bootstrap.bundle.min.js" %}></script>
    <script src={% static "assets/vendor/purecounter/purecounter_vanilla.js" %}></script>
    <script src={% static "assets/vendor/glightbox/js/glightbox.min.js" %}></script>
    <script src={% static "assets/vendor/swiper/swiper-bundle.min.js" %}></script>
    <script src={% static "assets/vendor/aos/aos.js" %}></script>
    <script src={% static "assets/vendor/php-email-form/validate.js" %}></script>

    <!-- Template Main JS File -->
    <script src={% static "assets/js/main.js" %}></script>

    <script>
        document.getElementById('rzp-button1').onclick = function (e) {
            e.preventDefault();

            var options = {
                "key": "{{ razorpay_key_id }}", // Enter the Key ID generated from the Dashboard
                "amount": "{{ amount }}", // Amount is in currency subunits (e.g., paise for INR)
                "currency": "{{ currency }}", // Use a valid currency code
                "name": "ICMBGSD 25",
                "description": "Payment for {{ payment.category }}",
                "order_id": "{{ razorpay_order_id }}", // This is the order ID generated by Razorpay
                "handler": function (response) {
                    // Post response to your server for verification
                    fetch("/payment/verify/", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                            "X-CSRFToken": "{{ csrf_token }}"
                        },
                        body: JSON.stringify({
                            razorpay_payment_id: response.razorpay_payment_id,
                            razorpay_order_id: response.razorpay_order_id,
                            razorpay_signature: response.razorpay_signature,
                        }),
                    }).then(response => response.json())
                        .then(data => {
                            if (data.success) {
                                window.location.href = data.redirect_url;
                            } else {
                                alert(data.error || "Payment verification failed!");
                            }
                        }).catch(error => {
                            console.error("Error verifying payment:", error);
                        });

                },
                "theme": {
                    "color": "#528FF0"
                }
            };
            console.log(options);

            var rzp = new Razorpay(options);
            rzp.open();
        }
    </script>
</body>

</html>