{% load static %}

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">

    <title>Maricon 2024</title>
    <meta content="" name="description">
    <meta content="" name="keywords">

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;500;600;700&family=Poppins:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">

    <!-- Vendor CSS Files -->
    <link href={% static "assets/vendor/bootstrap/css/bootstrap.min.css" %} rel="stylesheet">
    <link href={% static "assets/vendor/bootstrap-icons/bootstrap-icons.css" %} rel="stylesheet">
    <link href={% static "assets/vendor/fontawesome-free/css/all.min.css" %} rel="stylesheet">
    <link href={% static "assets/vendor/glightbox/css/glightbox.min.css" %} rel="stylesheet">
    <link href={% static "assets/vendor/swiper/swiper-bundle.min.css" %} rel="stylesheet">
    <link href={% static "assets/vendor/aos/aos.css" %} rel="stylesheet">
    <link href={% static 'assets/css/main.css' %} rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/style.css' %}">


    {% if err %}
    <script>
        window.onload = function () {
            alert("{{ err }}");
        }
    </script>
    {% endif %}

    <!-- Razorpay Checkout JS -->
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
</head>

<body>

    {% include "new_maricon/new_nav.html" %}
    <main id="main">

        <section class="d-flex align-items-center justify-content-center py-5" style="background-color: #eaf8f7; min-height: 100vh;">
            <div class="container">
                <div class="row justify-content-center w-100">
                    <div class="col-lg-6 text-center">
                        <div class="p-4 rounded" style="background-color: #ffffff;">
                            {% if err %}
                                <div class="alert alert-danger" role="alert">
                                    {{ err }}
                                </div>
                            {% endif %}
                            <h2 class="text-dark mb-4">Payment Details</h2>
                            <div class="mb-3 text-dark">
                                <strong>Name:</strong> {{ payment.user.full_name }}
                            </div>
                            <div class="mb-3 text-dark">
                                <strong>Category:</strong> {{ payment.category }}
                            </div>
                            <div class="mb-4 text-dark">
                                <strong>Total Amount:</strong> {{ payment.amount }} {{ payment.currency }}
                            </div>
                            <button id="rzp-button1" class="btn btn-primary w-100">Proceed to Pay</button>
                        </div>
                    </div>
                </div>
            </div>
        </section><!-- End Hero Section -->
        

    </main>
    {% include "new_maricon/new_footer.html" %}

    <a href="#" class="scroll-top d-flex align-items-center justify-content-center"><i
            class="bi bi-arrow-up-short"></i></a>

    <div id="preloader"></div>

    <!-- Vendor JS Files -->
    <script src={% static "assets/vendor/bootstrap/js/bootstrap.bundle.min.js" %}></script>
    <script src={% static "assets/vendor/purecounter/purecounter_vanilla.js" %}></script>
    <script src={% static "assets/vendor/glightbox/js/glightbox.min.js" %}></script>
    <script src={% static "assets/vendor/swiper/swiper-bundle.min.js" %}></script>
    <script src={% static "assets/vendor/aos/aos.js" %}></script>
    <script src={% static "assets/vendor/php-email-form/validate.js" %}></script>

    <!-- Template Main JS File -->
    <script src={% static "assets/js/main.js" %}></script>

    <script>
        document.getElementById('rzp-button1').onclick = function (e) {
            e.preventDefault();

            var options = {
                "key": "{{ razorpay_key_id }}", // Enter the Key ID generated from the Dashboard
                "amount": "{{ amount }}", // Amount is in currency subunits (e.g., paise for INR)
                "currency": "{{ currency }}", // Use a valid currency code
                "name": "ICMBGSD 25",
                "description": "Payment for {{ payment.category }}",
                "order_id": "{{ razorpay_order_id }}", // This is the order ID generated by Razorpay
                "handler": function (response) {
                    // Post response to your server for verification
                    fetch("/payment/verify/", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                            "X-CSRFToken": "{{ csrf_token }}"
                        },
                        body: JSON.stringify({
                            razorpay_payment_id: response.razorpay_payment_id,
                            razorpay_order_id: response.razorpay_order_id,
                            razorpay_signature: response.razorpay_signature,
                        }),
                    }).then(response => response.json())
                        .then(data => {
                            if (data.success) {
                                window.location.href = data.redirect_url;
                            } else {
                                alert(data.error || "Payment verification failed!");
                            }
                        }).catch(error => {
                            console.error("Error verifying payment:", error);
                        });

                },
                "theme": {
                    "color": "#528FF0"
                }
            };
            console.log(options);

            var rzp = new Razorpay(options);
            rzp.open();
        }
    </script>
</body>

</html>